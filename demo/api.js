import { derived, readable } from 'svelte/store'

const cached = {
  campaigns: [
    {
      advertiserDomainUrl: null,
      apks: [
        {
          fileName:
            'air.com.sgn.cookiejam.gp~a2e4f62a-cc52-4b86-b1a1-d5810a3b5200.apk',
          fileSize: 234116360,
          md5: '915f63a9a9f332a25461ad160fb8c6e1',
          networkType: 'both',
          packageName: 'air.com.sgn.cookiejam.gp',
          permissions: [
            'android.permission.ACCESS_NETWORK_STATE',
            'android.permission.ACCESS_WIFI_STATE',
            'android.permission.DISABLE_KEYGUARD',
            'android.permission.GET_TASKS',
            'android.permission.INTERNET',
            'android.permission.WRITE_EXTERNAL_STORAGE',
            'com.android.vending.BILLING',
            'com.google.android.c2dm.permission.RECEIVE',
          ],
          sha2: '218987e809c8d9d0d50f38f4ffa0e28c4368614a33fb0db817ce2c38a3bd8481',
          title: 'Cookie Jam',
          url: 'https://storage.googleapis.com/gcs-cs-ignite-microservices-apks-useast1-qa/a2e4f62a-cc52-4b86-b1a1-d5810a3b5200.apk',
          tocUrl: null,
          version: '12.70.140',
          versionCode: 1012070140,
          targetApks: null,
        },
      ],
      appId: 'air.com.sgn.cookiejam.gp',
      companionApps: null,
      appPrivacyPolicyUrl: null,
      averageRatingImageURL:
        'https://assets.gopda.com/hua/cdn/adpub/default/rated-5-5.png',
      bidRate: 0.245,
      billingTypeId: 2,
      callToAction: 'Install Now',
      campaignDisplayOrder: 1,
      campaignId: 34581,
      campaignTypeId: 2,
      composerArgs: null,
      enablePostInstallAutoLaunch: false,
      carrier: null,
      categoryName: 'Games',
      clickProxyURL:
        'https://prlds.latest-us-east-1.gcp-qa.digitalturbine.io/v2/preloadAd.jsp?siteId=26322&deviceId=7265&spotId=&sessionId=getAdsDebug&campaignId=34581&creativeId=373787&packageName=air.com.sgn.cookiejam.gp&fulfillmentTypeId=1&placementId=&campaignDisplayOrder=1&enc=true&ts=18cff82a1c8&algorithmId=-1&partner=4349&homeScreen=false&houseApp=false&installDelay=0&enableAutoLaunch=true&countryCode=US&bidId=BID296096399187364911966447378990414907934&adListId=03125d1e-0cea-41f4-b1dd-fc74ec755db0&enterpriseDeviceSettings=1&androidContentUri=false&id2=d1lSX0U=',
      creativeId: 373787,
      developerName: null,
      dtPrivacyPolicyUrl: null,
      externalMetadata: null,
      googlePlayAppStoreUrl: null,
      homeScreen: false,
      impressionTrackingURL:
        'https://impspg.latest-us-east-1.gcp-qa.digitalturbine.io/v2/impressionAd.jsp?siteId=26322&campaignId=34581&creativeId=373787&campaignDisplayOrder=1&ts=18cff82a1c8&sessionId=getAdsDebug&packageName=air.com.sgn.cookiejam.gp&enc=true&eventGroupId=EVTGID1705093800387933486470512&algorithmId=-1&partner=4349&countryCode=US&bidId=BID296096399187364911966447378990414907934&impressionId=IMP170674648877688203227844210490712858576&adListId=03125d1e-0cea-41f4-b1dd-fc74ec755db0&id2=d1lSX0U=',
      isRandomPick: true,
      longDescription: null,
      maxOSVersion: null,
      minOSVersion: null,
      mmpPartner: null,
      numberOfRatings: '10,000+',
      productDescription: 'cookie jam pickles',
      productId: 32070,
      productImage: null,
      productName: 'Cookie Jam',
      productThumbnail:
        'https://storage.googleapis.com/gcs-cs-ignite-microservices-static-images-useast1-qa/shared/creatives/32070/e567bd30d7074d529759f2e07c9dc9b3.png',
      rating: 5.0,
      numberOfDownloads: '10,000+',
      tstiEligible: false,
      stiEnabled: false,
      appDetailsWebViewUrl: null,
      appDetailsIsFullScreen: null,
      screenId: null,
      screenName: null,
      stiType: null,
      galleryAssetType: null,
      smartComponentData: {},
      screenshots: null,
      postInstallActions: [],
      useInstallerBroadcast: false,
      installDelay: 0,
      reclickAttribution: false,
      enableAutoLaunch: true,
      limitAdTracking: null,
      s2s: false,
      androidContentUri: false,
      metadata: {
        bidId: 'BID296096399187364911966447378990414907934',
        impressionId: 'IMP170674648877688203227844210490712858576',
        discovery: null,
        enterpriseDeviceSettings: 'Disabled',
        algorithmId: null,
      },
      dtid: null,
      simSlots: null,
      carrierName: null,
      groupName: null,
      deviceManufacturer: null,
      deviceModel: null,
      mobileInfos: null,
      doNotCheckForAppOpens: false,
    },
    {
      advertiserDomainUrl: null,
      apks: [
        {
          fileName:
            'com.supercell.clashofclans~093483d9-15db-4285-a816-2ec29f6e3c13.apk',
          fileSize: 313684756,
          md5: 'ba88d9d87609b57fa57d4d4a157fb185',
          networkType: 'both',
          packageName: 'com.supercell.clashofclans',
          permissions: [
            'android.permission.ACCESS_NETWORK_STATE',
            'android.permission.ACCESS_WIFI_STATE',
            'android.permission.CHANGE_WIFI_STATE',
            'android.permission.INTERNET',
            'android.permission.READ_EXTERNAL_STORAGE',
            'android.permission.WAKE_LOCK',
            'android.permission.WRITE_EXTERNAL_STORAGE',
            'com.android.vending.BILLING',
            'com.google.android.c2dm.permission.RECEIVE',
            'com.google.android.finsky.permission.BIND_GET_INSTALL_REFERRER_SERVICE',
          ],
          sha2: '4a5fe8b3943eccafbca1f79737bf922ea07811b0ad902c2abb356380c232a8cf',
          title: 'Clash of Clans',
          url: 'https://storage.googleapis.com/gcs-cs-ignite-microservices-apks-useast1-qa/093483d9-15db-4285-a816-2ec29f6e3c13.apk',
          tocUrl: null,
          version: '15.83.29',
          versionCode: 1543,
          targetApks: null,
        },
      ],
      appId: 'com.supercell.clashofclans',
      companionApps: null,
      appPrivacyPolicyUrl: null,
      averageRatingImageURL:
        'https://assets.gopda.com/hua/cdn/adpub/default/rated-5-5.png',
      bidRate: 0.245,
      billingTypeId: 2,
      callToAction: 'Install Now',
      campaignDisplayOrder: 2,
      campaignId: 34584,
      campaignTypeId: 2,
      composerArgs: null,
      enablePostInstallAutoLaunch: false,
      carrier: null,
      categoryName: 'Games',
      clickProxyURL:
        'https://prlds.latest-us-east-1.gcp-qa.digitalturbine.io/v2/preloadAd.jsp?siteId=26322&deviceId=7265&spotId=&sessionId=getAdsDebug&campaignId=34584&creativeId=373789&packageName=com.supercell.clashofclans&fulfillmentTypeId=1&placementId=&campaignDisplayOrder=2&enc=true&ts=18cff82a1ca&algorithmId=-1&partner=4349&homeScreen=false&houseApp=false&installDelay=0&enableAutoLaunch=true&countryCode=US&bidId=BID71302578352459722033472804787079025242&adListId=03125d1e-0cea-41f4-b1dd-fc74ec755db0&enterpriseDeviceSettings=1&androidContentUri=false&id2=dl5eXExU',
      creativeId: 373789,
      developerName: null,
      dtPrivacyPolicyUrl: null,
      externalMetadata: null,
      googlePlayAppStoreUrl: null,
      homeScreen: false,
      impressionTrackingURL:
        'https://impspg.latest-us-east-1.gcp-qa.digitalturbine.io/v2/impressionAd.jsp?siteId=26322&campaignId=34584&creativeId=373789&campaignDisplayOrder=2&ts=18cff82a1ca&sessionId=getAdsDebug&packageName=com.supercell.clashofclans&enc=true&eventGroupId=EVTGID1705093800387933486470512&algorithmId=-1&partner=4349&countryCode=US&bidId=BID71302578352459722033472804787079025242&impressionId=IMP323346863145393327532502297702099374752&adListId=03125d1e-0cea-41f4-b1dd-fc74ec755db0&id2=dl5eXExU',
      isRandomPick: true,
      longDescription: null,
      maxOSVersion: null,
      minOSVersion: null,
      mmpPartner: null,
      numberOfRatings: '10,000+',
      productDescription: 'coc image',
      productId: 32071,
      productImage: null,
      productName: 'Clash of clans',
      productThumbnail:
        'https://storage.googleapis.com/gcs-cs-ignite-microservices-static-images-useast1-qa/shared/creatives/32071/4d7cc5feac8f4396b337085b48451223.png',
      rating: 5.0,
      numberOfDownloads: '10,000+',
      tstiEligible: false,
      stiEnabled: false,
      appDetailsWebViewUrl: null,
      appDetailsIsFullScreen: null,
      screenId: null,
      screenName: null,
      stiType: null,
      galleryAssetType: null,
      smartComponentData: {},
      screenshots: null,
      postInstallActions: [],
      useInstallerBroadcast: false,
      installDelay: 0,
      reclickAttribution: false,
      enableAutoLaunch: true,
      limitAdTracking: null,
      s2s: false,
      androidContentUri: false,
      metadata: {
        bidId: 'BID71302578352459722033472804787079025242',
        impressionId: 'IMP323346863145393327532502297702099374752',
        discovery: null,
        enterpriseDeviceSettings: 'Disabled',
        algorithmId: null,
      },
      dtid: null,
      simSlots: null,
      carrierName: null,
      groupName: null,
      deviceManufacturer: null,
      deviceModel: null,
      mobileInfos: null,
      doNotCheckForAppOpens: false,
    },
    {
      advertiserDomainUrl: null,
      apks: [],
      appId: 'com.nvsgames.snap',
      companionApps: null,
      appPrivacyPolicyUrl: null,
      averageRatingImageURL:
        'https://assets.gopda.com/hua/cdn/adpub/default/rated-5-5.png',
      bidRate: 0.245,
      billingTypeId: 2,
      callToAction: 'Install Now',
      campaignDisplayOrder: 3,
      campaignId: 34586,
      campaignTypeId: 2,
      composerArgs: null,
      enablePostInstallAutoLaunch: false,
      carrier: null,
      categoryName: 'Games',
      clickProxyURL:
        'https://prlds.latest-us-east-1.gcp-qa.digitalturbine.io/v2/preloadAd.jsp?siteId=26322&deviceId=7265&spotId=&sessionId=getAdsDebug&campaignId=34586&creativeId=373793&packageName=com.nvsgames.snap&fulfillmentTypeId=1&placementId=&campaignDisplayOrder=3&enc=true&ts=18cff82a1cb&algorithmId=-1&partner=4349&homeScreen=false&houseApp=false&installDelay=0&enableAutoLaunch=true&countryCode=US&bidId=BID186250051572949285186319612211343080043&adListId=03125d1e-0cea-41f4-b1dd-fc74ec755db0&enterpriseDeviceSettings=1&androidContentUri=false&id2=dl9eW0VW',
      creativeId: 373793,
      developerName: null,
      dtPrivacyPolicyUrl: null,
      externalMetadata: null,
      googlePlayAppStoreUrl: null,
      homeScreen: false,
      impressionTrackingURL:
        'https://impspg.latest-us-east-1.gcp-qa.digitalturbine.io/v2/impressionAd.jsp?siteId=26322&campaignId=34586&creativeId=373793&campaignDisplayOrder=3&ts=18cff82a1cb&sessionId=getAdsDebug&packageName=com.nvsgames.snap&enc=true&eventGroupId=EVTGID1705093800387933486470512&algorithmId=-1&partner=4349&countryCode=US&bidId=BID186250051572949285186319612211343080043&impressionId=IMP310311075803961643521660892263798992145&adListId=03125d1e-0cea-41f4-b1dd-fc74ec755db0&id2=dl9eW0VW',
      isRandomPick: true,
      longDescription: null,
      maxOSVersion: null,
      minOSVersion: null,
      mmpPartner: null,
      numberOfRatings: '10,000+',
      productDescription: 'marvel snap',
      productId: 32074,
      productImage: null,
      productName: 'Marvel Snap',
      productThumbnail:
        'https://storage.googleapis.com/gcs-cs-ignite-microservices-static-images-useast1-qa/shared/creatives/32074/824974c275e94edea1e5d7a00fec0272.png',
      rating: 5.0,
      numberOfDownloads: '10,000+',
      tstiEligible: false,
      stiEnabled: false,
      appDetailsWebViewUrl: null,
      appDetailsIsFullScreen: null,
      screenId: null,
      screenName: null,
      stiType: null,
      galleryAssetType: null,
      smartComponentData: {},
      screenshots: null,
      postInstallActions: [],
      useInstallerBroadcast: false,
      installDelay: 0,
      reclickAttribution: false,
      enableAutoLaunch: true,
      limitAdTracking: null,
      s2s: false,
      androidContentUri: false,
      metadata: {
        bidId: 'BID186250051572949285186319612211343080043',
        impressionId: 'IMP310311075803961643521660892263798992145',
        discovery: null,
        enterpriseDeviceSettings: 'Disabled',
        algorithmId: null,
      },
      dtid: null,
      simSlots: null,
      carrierName: null,
      groupName: null,
      deviceManufacturer: null,
      deviceModel: null,
      mobileInfos: null,
      doNotCheckForAppOpens: false,
    },
    {
      advertiserDomainUrl: null,
      apks: [],
      appId: 'com.nianticlabs.pokemongo',
      companionApps: null,
      appPrivacyPolicyUrl: null,
      averageRatingImageURL:
        'https://assets.gopda.com/hua/cdn/adpub/default/rated-5-5.png',
      bidRate: 0.245,
      billingTypeId: 2,
      callToAction: 'Install Now',
      campaignDisplayOrder: 4,
      campaignId: 34585,
      campaignTypeId: 2,
      composerArgs: null,
      enablePostInstallAutoLaunch: false,
      carrier: null,
      categoryName: 'Games',
      clickProxyURL:
        'https://prlds.latest-us-east-1.gcp-qa.digitalturbine.io/v2/preloadAd.jsp?siteId=26322&deviceId=7265&spotId=&sessionId=getAdsDebug&campaignId=34585&creativeId=373790&packageName=com.nianticlabs.pokemongo&fulfillmentTypeId=1&placementId=&campaignDisplayOrder=4&enc=true&ts=18cff82a1cb&algorithmId=-1&partner=4349&homeScreen=false&houseApp=false&installDelay=0&enableAutoLaunch=true&countryCode=US&bidId=BID278542089143581381536128888864262093819&adListId=03125d1e-0cea-41f4-b1dd-fc74ec755db0&enterpriseDeviceSettings=1&androidContentUri=false&id2=fV5RUUU=',
      creativeId: 373790,
      developerName: null,
      dtPrivacyPolicyUrl: null,
      externalMetadata: null,
      googlePlayAppStoreUrl: null,
      homeScreen: false,
      impressionTrackingURL:
        'https://impspg.latest-us-east-1.gcp-qa.digitalturbine.io/v2/impressionAd.jsp?siteId=26322&campaignId=34585&creativeId=373790&campaignDisplayOrder=4&ts=18cff82a1cb&sessionId=getAdsDebug&packageName=com.nianticlabs.pokemongo&enc=true&eventGroupId=EVTGID1705093800387933486470512&algorithmId=-1&partner=4349&countryCode=US&bidId=BID278542089143581381536128888864262093819&impressionId=IMP216002732811501137971627461418945866165&adListId=03125d1e-0cea-41f4-b1dd-fc74ec755db0&id2=fV5RUUU=',
      isRandomPick: true,
      longDescription: null,
      maxOSVersion: null,
      minOSVersion: null,
      mmpPartner: null,
      numberOfRatings: '10,000+',
      productDescription: 'pokemon go',
      productId: 32072,
      productImage: null,
      productName: 'Pokemon GO',
      productThumbnail:
        'https://storage.googleapis.com/gcs-cs-ignite-microservices-static-images-useast1-qa/shared/creatives/32072/12570a0135174e419e39364f9b4d82de.png',
      rating: 5.0,
      numberOfDownloads: '10,000+',
      tstiEligible: false,
      stiEnabled: false,
      appDetailsWebViewUrl: null,
      appDetailsIsFullScreen: null,
      screenId: null,
      screenName: null,
      stiType: null,
      galleryAssetType: null,
      smartComponentData: {},
      screenshots: null,
      postInstallActions: [],
      useInstallerBroadcast: false,
      installDelay: 0,
      reclickAttribution: false,
      enableAutoLaunch: true,
      limitAdTracking: null,
      s2s: false,
      androidContentUri: false,
      metadata: {
        bidId: 'BID278542089143581381536128888864262093819',
        impressionId: 'IMP216002732811501137971627461418945866165',
        discovery: null,
        enterpriseDeviceSettings: 'Disabled',
        algorithmId: null,
      },
      dtid: null,
      simSlots: null,
      carrierName: null,
      groupName: null,
      deviceManufacturer: null,
      deviceModel: null,
      mobileInfos: null,
      doNotCheckForAppOpens: false,
    },
  ],
  totalCampaignsRequested: 20,
  serverId: null,
  responseTime: '0.009 seconds',
  errorMessage: null,
  version: 'v2',
  adListId: '03125d1e-0cea-41f4-b1dd-fc74ec755db0',
}

const readableData = readable(cached, (set) => {
  fetch('https://storage.googleapis.com/web-ads-cache/response.json').then(
    async (res) => {
      // const json = await res.json()
      // console.log({ json })
      set(await res.json())
    },
  )

  return () => {}
})

export default derived(
  readableData,
  ($data, set) => {
    // console.log('data', $data)
    set(
      $data.campaigns?.slice(0, 5).map((ad) => ({
        title: ad.productName,
        src: ad.productImage || ad.productThumbnail,
        desc: ad.productDescription,
        href:
          ad.clickProxyURL ||
          "javascript:alert('No clickProxyURL was set for this campaign')",
      })),
    )
  },
  [],
)
